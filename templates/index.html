<!DOCTYPE html>
<html>
<head>
    <title>Supervisely Applications: Batched Smart Tool</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/svg.select.js@3.0.1/dist/svg.select.min.css"/>
    <link rel="stylesheet" href="https://supervise.ly/apps-designer.bundle.css"/>


    <style>
        .svg_select_points_rot {
            display: none;
        }

        .sly-smart-tool__annotation {
            opacity: 0.5;
        }

        .sly-smart-tool__point {
            stroke: white;
            stroke-width: 1px;
            /* fill: none; */
        }

        .sly-smart-tool__point:hover {
            cursor: pointer;
        }

        .sly-smart-tool__point.positive:hover {
            stroke: green;
        }

        .sly-smart-tool__point.negative:hover {
            stroke: red;
        }
    </style>
</head>

<body style="font-family: Verdana">


<script src="https://supervise.ly/apps-designer.bundle.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsoneditor@9.7.0/dist/jsoneditor.min.css">
<script src="https://cdn.jsdelivr.net/npm/jsoneditor@9.7.0/dist/jsoneditor.min.js"></script>


<!--<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>-->
<link href="https://cdnjs.cloudflare.com/ajax/libs/element-ui/2.15.7/theme-chalk/index.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/element-ui/2.15.7/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fast-json-patch@3.1.0/dist/fast-json-patch.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/svg.js@2.7.1/dist/svg.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/svg.select.js@3.0.1/dist/svg.select.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/svg.resize.js@1.4.3/dist/svg.resize.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/svg.draggable.js@2.2.2/dist/svg.draggable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/svg.panzoom.js@1.2.3/dist/svg.panzoom.min.js"></script>
<script src="https://rawgit.com/nodeca/pako/1.0.11/dist/pako.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuidv4.min.js"></script>

<script src="https://supervisely-ecosystem.github.io/supervisely-app-frontend-js/SlyApp.js"></script>
<script src="/static/smarttool.js"></script>


<div id="sly-app">
    <sly-app>
        <template v-slot="{ post, state, data }">
<!--            <json-viewer :value="{'state': state, 'data': data}"-->
<!--                         style="position: fixed; top: 0; right: 0"></json-viewer>-->

            <div style="display: flex; flex-direction: column; margin: 20px 0; width: 50%;
                        border: #c1c1c1 2px solid; border-radius: 20px;
                        padding: 15px; padding-top: 8px">
                <div style="display: flex; flex-direction: row; justify-content: space-between; padding: 0 5px">

                    <h3>Batched Smart Tool [demo]</h3>
                    <div>
                        <el-button type="primary" class="regular" size="small" style="margin: 15px 5px;"
                                   @click="post('/get_image_from_dataset')">LOAD IMAGE
                        </el-button>

                        <el-button type="primary" class="regular" size="small" style="margin: 15px 5px;"
                                   @click="post('/update_masks')">UPDATE MASKS
                        </el-button>

                        <el-button v-if="state.finished === false" type="primary" class="regular" size="small"
                                   style="margin: 15px 5px;"
                                   @click="post('/upload_to_project')">UPLOAD TO PROJECT
                        </el-button>
                        <a v-else href="https://supervisely-dev.deepsystems.io/projects/9100/datasets" target="_blank">
                            <el-button type="success" class="regular" size="small" style="margin: 15px 5px;">
                                OPEN PROJECT
                            </el-button>
                        </a>

                    </div>

                </div>


                <div style="width: 100%; margin-bottom: 10px">
                    <div> {{{sly_tqdm.to_html(identifier = 'progress_1') | safe }}}</div>
                </div>
            </div>


            <div id="smart-tool-clickers-container"
                 style="display: flex; width:100%;
                     flex-direction: row;
                     flex-wrap: wrap">
                {% for i in range(30) %}
                {{{smart_tool.to_html(identifier = i) | safe }}}
                {% endfor %}
            </div>

            <div style="display: flex">
                <div>
                    <el-button type="success" class="regular" size="small" style="margin: 15px 2px;"
                               @click="post('/change_all_buttons', {'mode': 'on'})">ALL ON
                    </el-button>
                </div>
                <div>
                    <el-button type="danger" class="regular" size="small" style="margin: 15px 2px;"
                               @click="post('/change_all_buttons'), {'mode': 'off'}">ALL OFF
                    </el-button>
                </div>

            </div>


        </template>
    </sly-app>
</div>

<!--<include src="/static/widgets.html"></include>-->


<script>
    Vue.component('vue-smart-seg-widget', {
        props: ['data', 'post'],
        template: `
          <div style="width: 250px; height:250px; border: #77b4ff solid 1px;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    position: relative">


          <div style="display: flex; align-items: center; justify-content: space-between;
                          position: absolute">

            <el-switch
                style="margin: 10px 10px"
                v-model="data.isActive"
                on-text=""
                off-text="">
            </el-switch>
          </div>

          <smarttool-editor
              style="width: 100%; height: 100%;"
              :mask="data.mask"
              :image-url="data.imageUrl"
              :bbox.sync="data.bbox"
              @update:bbox="data.bbox = $event; update_annotation()"
              :positive-points="data.positivePoints"
              @update:positive-points="data.positivePoints = $event; update_annotation()"
              :negative-points="data.negativePoints"
              @update:negative-points="data.negativePoints = $event; update_annotation()"
          ></smarttool-editor>
          </div>

        `,
        methods: {
            async update_annotation() {
                await this.post('/update_annotation', {
                        'identifier': this.data.identifier
                    }
                )
            }
        }
    })


    Vue.component('json-viewer', {
        props: ['value'],
        template: `
          <div>
          <div ref="jsoneditor" style="width: 340px; height: 350px;"></div>
          </div>
        `,
        watch: {
            value: {
                handler(value) {

                    this.editor.set(value);
                },
                // slow implementation
                deep: true,
            },
        },
        mounted() {
            const container = this.$refs.jsoneditor;
            const options = {
                mode: 'view'
            };

            this.editor = new JSONEditor(container, options);
            this.editor.set(this.value);

        }

    })
    ;
</script>


</body>
</html>
